<%- include('../../partials/head'); %>

<body>
<div class="layout">
  <%- include('../../partials/header'); %>

  <%- include('../../partials/sidebar'); %>
  <main id="noticeRegistPage">
    <form @submit.prevent="onSubmit" name="notice_regist">
      <button type="submit" class="btn btn-primary">プレビュー</button>
      <button type="submit" class="btn btn-primary">登録</button>

      <div class="form-group row mb-4">
        <label class="col-sm-4 col-form-label">
          公開範囲
          <span class="badge bg-danger">必須</span>
        </label>
        <div class="col-md-8">
          <input
            v-model="$v.open_range.$model"
            name="open_range"
            value="consumer"
            class="form-check-input"
            type="radio"
            id="consumer"
          />
          <label class="form-check-label" for="consumer">コンシューマ</label>
          <input
            v-model="$v.open_range.$model"
            name="open_range"
            value="back_office" 
            class="form-check-input"
            type="radio"
            id="back_office"
          />
          <label class="form-check-label" for="back_office">バックオフィス</label>
          <div v-if="$v.open_range.$dirty" class="text-danger fw-bold">
            <span v-if="!$v.open_range.required">必須項目が選択されていません。</span>
          </div>
        </div>
      </div>

      <div class="form-group row mb-4">
        <label class="col-sm-4 col-form-label">
          お知らせタイトル
          <span class="badge bg-danger">必須</span>
        </label>
        <div class="col-md-8">
          <input
            v-model="$v.notice_title.$model"
            name="notice_title"
            maxlength="50"
            type="text"
            class="form-control mb-1"
          />
          <div v-if="$v.notice_title.$dirty" class="text-danger fw-bold">
            <span v-if="!$v.notice_title.required">必須項目が入力されていません。</span>
          </div>
        </div>
      </div>

      <div class="form-group row mb-4">
        <label class="col-sm-4 col-form-label">
          お知らせ本文
          <span class="badge bg-danger">必須</span>
        </label>
        <div class="col-md-8">
          <textarea
            v-model="$v.notice_body.$model"
            name="notice_body"
            maxlength="2000"
            rows="3"
            class="form-control mb-1"
          ></textarea>
          <div v-if="$v.notice_body.$dirty" class="text-danger fw-bold">
            <span v-if="!$v.notice_body.required">必須項目が入力されていません。</span>
          </div>
        </div>
      </div>

      <div class="form-group row mb-4">
        <label class="col-sm-4 col-form-label">
          タグ
          <span class="badge bg-danger">必須</span>
        </label>
        <div class="col-md-8">
          <select :value="tag.value" @change="onFormChange('tag',$event.target.value)" name="tag" class="form-select">
            <option
              v-for="item in tag.items"
              :key="item.name"
              :value="item.name"
            >{{ item.name }}</option>
          </select>
        </div>
      </div>

      <div class="form-group row mb-4">
        <label class="col-sm-4 col-form-label">
          投稿日時
          <span class="badge bg-danger">必須</span>
        </label>
        <div class="col-md-8">
          <input
            v-model="dateTime.picked"
            value="type1"
            id="type1"
            class="form-check-input"
            type="radio"
          >
          <label class="form-check-label" for="type1">
            日時を指定
          </label>
          <input
            v-model="dateTime.picked"
            value="type2"
            id="type2"
            class="form-check-input"
            type="radio"
          >
          <label class="form-check-label" for="type2">
            即時を指定
          </label>
          <template v-if="dateTime.picked==='type1'">
            <vue-ctk-date-time-picker
            name="date_time"
            v-model="dateTime.value"
            formatted="YYYY/MM/DD hh:mm"
            :min-date="dateTime.minDate"
            position="top"
            label=""
            />
          </template>
          <template v-else>
            <input name="date_time" type="hidden" value="現在日付">
          </template>
        </div>
      </div>
    </form>
  </main>
</div>

<script type="text/javascript">
const VueCtkDateTimePicker = window['vue-ctk-date-time-picker'];
Vue.component('vue-ctk-date-time-picker', VueCtkDateTimePicker);

Vue.use(window.vuelidate.default);
const { required } = window.validators;

let tagLists = `<%- tagLists %>`;

new Vue({
  el: "#noticeRegistPage",
  data: {
    // 送信データ
    open_range: "",
    notice_title: "",
    notice_body: "",

    tag: {
      value: JSON.parse(tagLists)[0].name,
      items: JSON.parse(tagLists),
    },
    dateTime: {
      picked: "type1",
      value: null,
      minDate: moment().format('YYYY-MM-DD'),
    }
  },
  validations: {
    open_range: {
      required,
    },
    notice_title: {
      required,
    },
    notice_body: {
      required,
    },
  },
  methods: {
    onFormChange(target, updateValue) {
      data[name].value = updateValue;
    },
    onSubmit() {
      this.$v.$touch();
      if(!this.$v.$invalid) {
        document.notice_regist.method="post";
        document.notice_regist.action = "notice_regist";
        document.notice_regist.submit();
      }
    }
  }
})
</script>
</body>
</html>