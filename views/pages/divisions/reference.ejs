<%- include('../../partials/head'); %>

<body>
<div class="layout">
  <%- include('../../partials/header'); %>

  <%- include('../../partials/sidebar'); %>

  <main id="divisionsReference">    
    <h4 class="mb-4 fw-bold">料金区分一覧</h4>

    <div class="d-flex flex-row-reverse mb-4">
      <button class="dropdown border-0 bg-white" type="button" data-bs-toggle="dropdown">
        <img src="/images/icon/plus.svg">
      </button>
      <ul class="dropdown-menu">
        <a href="/products/plan/regist/3"><li class="dropdown-item small">プランを新しく登録する</li></a>
      </ul>
    </div>

    <form class="mb-5">
      <!-- 一覧テーブル -->
      <table class="table align-middle mb-5">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">料金区分ID</th>
            <th scope="col">料金区分名</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in divisions" :key="index">
            <th>{{ index + 1 }}</th>
            <td>{{ item.divisionId }}</td>
            <td>{{ item.divisionName }}</td>
          </tr>
        </tbody>
      </table>
      <!-- ページネーション -->
      <nav class="d-flex justify-content-center" aria-label="Page navigation">
        <ul class="pagination">
          <li :class="{'disabled': Number(pageNumber) === 1}" class="page-item">
            <button
              @click="onPageChange(Number(pageNumber) - 1)"
              type="button"
              class="page-link">Previous
            </button>
          </li>
          <li
            v-for="value of totalPageCount"
            :key="value"
            :class="{'active': value === Number(pageNumber)}"
            class="page-item"
          >
            <button
              @click="onPageChange(value)"
              type="button"
              class="page-link">{{value}}
            </button>
          </li>
          <li :class="{'disabled': Number(pageNumber) === Number(totalPageCount)}" class="page-item">
            <button
              @click="onPageChange(Number(pageNumber) + 1)"
              type="button"
              class="page-link">Next
            </button>
          </li>
        </ul>
      </nav>
    </form>
  </main>
</div>

<script type="text/javascript">
const productId= `<%- productId %>`;
const divisions= `<%- divisions %>`;
const totalPageCount= `<%- totalPageCount %>`;

const queryParam = new URLSearchParams(location.search);
  
new Vue({
  el: "#divisionsReference",
  data: {
    // APIデータ
    productId: JSON.parse(productId),
    divisions: JSON.parse(divisions),
    totalPageCount: JSON.parse(totalPageCount),
    // 検索データ
    pageNumber: queryParam.get('pageNumber') ?? 1,
  },
  created() {
    queryParam.set("pageNumber", this.pageNumber);
  },
  methods: {
    // キーワード（検索条件 更新）
    onFormChange(e) {
      queryParam.set(e.target.name, e.target.value);
    },
    // 検索条件セット
    onPageChange(page) {
      queryParam.set("pageNumber", page);
      this.onSerch();
    },
    // 再レンダリング
    onSerch() {
      window.location.href = `/divisions/${ this.productId }/reference?${ queryParam }`;
    },
    // リダイレクト
    onRedirect(item) {
      window.location.href = `/divisions/${ this.productId }/detail/${ item.divisionId }`;
    },
  }
})
</script>
</body>
</html>