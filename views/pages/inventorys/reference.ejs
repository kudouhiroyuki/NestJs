<%- include('../../partials/head'); %>

<body>
<div class="layout">
  <%- include('../../partials/header'); %>

  <%- include('../../partials/sidebar'); %>

  <main id="inventorysReference">    
    <h4 class="mb-4 fw-bold">在庫一覧</h4>
    
    <div class="d-flex flex-row-reverse mb-5">
      <a :href=`/inventorys/${productId}/regist`>
        <input type="button" value="新規在庫登録" class="btn baseBtnBlue">
      </a>
    </div>

    <form @submit.prevent="onSerch">
      <!-- 条件フォーム -->
      <div class="baseShadow p-3 mb-5">
      <h5 class="mb-4 fw-bold">条件</h5>
      <div class="row">
        <div class="col-4">
          <label class="form-label">キーワード</label>
          <input
            @change="onFormChange"
            :value="keyword"
            name="keyword"
            type="text"
            class="form-control"
            placeholder="キーワード"
          >
        </div>
        <div class="col-4 text-end">
          <button type="submit" class="btn w-50 mt-4 baseBtnGrey">
            <img src="/images/icon/serch.svg">
            検索
          </button>
        </div>
      </div>
    </div>
      <!-- 一覧テーブル -->
      <table class="table align-middle mb-5">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">在庫ID</th>
            <th scope="col">在庫名</th>
            <th scope="col">在庫管理種別</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in inventorys" :key="index">
            <th>{{ index + 1 }}</th>
            <td>{{ item.inventoryId }}</td>
            <td>{{ item.inventoryName }}</td>
            <td>{{ item.inventoryKind }}</td>
            <td>
              <a :href=`/inventorys/${item.productId}/detail/${item.inventoryId}` style="cursor: pointer; color: #1867C0">
                <button type="button" class="btn baseBtnGrey">在庫確認</button>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
      <!-- ページネーション -->
      <nav class="d-flex justify-content-center" aria-label="Page navigation">
        <ul class="pagination">
          <li :class="{'disabled': Number(pageNumber) === 1}" class="page-item">
            <button
              @click="onPageChange(Number(pageNumber) - 1)"
              type="button"
              class="page-link">Previous
            </button>
          </li>
          <li
            v-for="value of totalPageCount"
            :key="value"
            :class="{'active': value === Number(pageNumber)}"
            class="page-item"
          >
            <button
              @click="onPageChange(value)"
              type="button"
              class="page-link">{{value}}
            </button>
          </li>
          <li :class="{'disabled': Number(pageNumber) === Number(totalPageCount)}" class="page-item">
            <button
              @click="onPageChange(Number(pageNumber) + 1)"
              type="button"
              class="page-link">Next
            </button>
          </li>
        </ul>
      </nav>
    </form>
  </main>
</div>

<script type="text/javascript">
const inventorys= `<%- inventorys %>`;
const totalPageCount= `<%- totalPageCount %>`;

const queryParam = new URLSearchParams(location.search);

new Vue({
  el: "#inventorysReference",
  data: {
    // APIデータ
    inventorys: JSON.parse(inventorys),
    totalPageCount: JSON.parse(totalPageCount),
    // 検索データ
    productId: queryParam.get('productId') ?? null,
    keyword: queryParam.get('keyword') ?? "",
    pageNumber: queryParam.get('pageNumber') ?? 1,
  },
  created() {
    queryParam.set("productId", this.productId);
    queryParam.set("keyword", this.keyword);
    queryParam.set("pageNumber", this.pageNumber);
  },
  methods: {
    // キーワード（検索条件 更新）
    onFormChange(e) {
      queryParam.set(e.target.name, e.target.value);
    },
    // 検索条件セット
    onPageChange(page) {
      queryParam.set("pageNumber", page);
      this.onSerch();
    },
    // 画面リロード    
    onSerch() {
      window.location.href = `/inventorys/reference?${ queryParam }`;
    },
    // リダイレクト
    onRedirect(item) {
      window.location.href = `/inventorys/${ this.productId }/detail/${ item.divisionId }`;
    },
  }
})
</script>
</body>
</html>